<!DOCTYPE html>
<html>
<head>
  #this create the google button
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js">
  </script>

  <script src="https://apis.google.com/js/client:platform.js?onload=start" async defer>
  </script>
</head>

<body>
  # this create the div to hold the actual google button>
<div id="signinButton"
  <span class="g-signin"
    data-scope="openid email"
    data-cleintid="723796939992-s46q06ml7dsacorbu51ja3patsssoh3g.apps.googleusercontent.com"
    data-redirecturi="postmessage"
    data-accesstype="offline"
    data-cookiepolicy="single_host_origin"
    data-callback="signinCallback"
    data-approvalprompt="force">
  </span>
</div>
<div id="result"</div>

<script>
function signInCallBack(authResult) {
  if (authResult['code']) {

    //Hide the sign-in button now that user authorized
    $('#signinButton').attr('style', 'display: none');

    // Send the one-time use code to the servier , if the server responds, write a 'login Sucessful' message to the web page and then redirect back to the main Catalog Items page
    $.ajax({
      type: 'POST',
      url: '/gconnect?state={{STATE}}', #argument against xsite attck
      processData: false,  #dont wnt reponse to proce  as string
      data: authResult['code'],
      contentType: 'application/octet-stream; chartset=utf=8',
      sucess: function(result) {
        //Handle or verify the server response if necessary.
        if (result) {
          $('#result').html(result)
          setTimeout(function() {
            window.location.href = "/";
          }, 5000);


      } else if (authResult['error']) {

    console.log('There was an error: ' + authResult['error']);
  } else {
        $('#result').html('Failed to make a server-side call. Check your configuration and console');
          }
      }
}); } }
</scrip>

{% endblock %}
